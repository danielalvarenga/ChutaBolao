<?phprequire "bootstrap.php";if(isset($_POST)){	for ($i=0;$i<sizeof($_POST)/3;$i++){		$x= $i * 3;		$y= ($i * 3)+1;		$z= ($i * 3)+2;		$jogo_numero= $_POST[$x];		$palpite_time1_jogo= $_POST[$y];		$palpite_time2_jogo= $_POST[$z];		$dqlApostaCadastrada = "SELECT a FROM Aposta a WHERE a.jogo=$jogo_numero AND a.usuario='$user_id'";		$queryApostaCadastrada = $entityManager->createQuery($dqlApostaCadastrada);		$apostasCadastrada = $queryApostaCadastrada->getResult();		$dqlJogo = "SELECT j FROM Jogo j WHERE j.codJogo=$jogo_numero AND j.campeonato=1";		$queryJogo = $entityManager->createQuery($dqlJogo);		$jogos = $queryJogo->getResult();		$campeonato= $entityManager->find("Campeonato", 1);		$usuario = $entityManager->find("Usuario",$user_id );		if ($apostasCadastrada<>NULL){			foreach ($apostasCadastrada as $apostaCadastrada){				$golsTimes1=$apostaCadastrada->getApostaGolsTime1();				$golsTimes2=$apostaCadastrada->getApostaGolsTime2();			}			if ($golsTimes1<>$palpite_time1_jogo) {				$apostaCadastrada->setApostaGolsTime1($palpite_time1_jogo);				$entityManager->merge($apostaCadastrada);				$entityManager->flush();			}			if($golsTimes2<>$palpite_time2_jogo){				$apostaCadastrada->setApostaGolsTime2($palpite_time2_jogo);				$entityManager->merge($apostaCadastrada);				$entityManager->flush();			}		}		else{			if (($palpite_time1_jogo<>'') && ($palpite_time2_jogo<>'')){				foreach ($jogos as $jogo){					$apostaNova=new Aposta($usuario, $campeonato, $jogo);					$apostaNova->setApostaGolsTime1($palpite_time1_jogo);					$apostaNova->setApostaGolsTime2($palpite_time2_jogo);					$entityManager->persist($apostaNova);					$entityManager->flush();								}			}		}	}}//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////?><?php/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	require "bootstrap.php";	echo "<br><h2 align='center'color='black'> <br><br>";	// Essa variavel opcaoVazia e para mostrar quando o usuario nao fez aposta no respectivo jogo.	$opcaoVazia=' ';	//Essa variavel e para imprimir um X entre os dois times que estao jogando	$imprimeLetraX="  X  ";	$dataAgora = new DateTime('now', new DateTimeZone('America/Sao_Paulo'));	$dataAtual = $dataAgora->format( "Y-m-d H:i:s" );	// Essa parte do codigo busca os jogos cadastradas dentro do banco de dados.	$dqlJogo = "SELECT j FROM Jogo j WHERE'$dataAtual'>= j.dataInicioApostas AND '$dataAtual	'<=j.dataFimApostas ORDER BY j.dataJogo ";	//$dqlJogo="SELECT j FROM Jogo j WHERE j.dataJogo>'$dataAtual'";	$queryJogo = $entityManager->createQuery($dqlJogo);	$jogos = $queryJogo->getResult();	//Aqui esta testando se a busca voltou com algum jogo ou nao	if($jogos<>NULL){		echo"<html>			<body><table>";		//Aqui e o metodo de envio dos dados e o endereco pra onde esta enviando		echo"<form action='' method='POST' >";		//A variavel contadorArray serve pra ajudar a enumerar a posicao onde vai ficar armazenado		//as posicoes referentes ao codigo do jogo, o palpite de usuario para o time 1 e time 2		$contadorArray=0;		foreach ($jogos as $jogo){			$codJogo=$jogo->getCodJogo();			$imprime1=$jogo->getCodtime1();			$imprime2=$jogo->getCodtime2();			//As tres variaveis abaixo e pra nomear as posicoes do array mas com numeros e nao palavras			//facilitando assim o recebimento da informacao na pagina cadastro_aposta.php independente de			//quantos jogos estao com as apostas liberadas			$numeroJogo= $contadorArray *3;			$apostaGolsUsuarioTime1=($contadorArray * 3)+1;			$apostaGolsUsuarioTime2=($contadorArray * 3)+2;			echo "<table>";							// Essa parte do codigo busca aposta do usuario de acordo com o numero do			//jogo cadastradas dentro do banco de dados.			$dqlAposta = "SELECT a FROM Aposta a WHERE a.jogo=$codJogo AND a.usuario=$user_id ";			$queryAposta = $entityManager->createQuery($dqlAposta);			$apostas = $queryAposta->getResult();			//Aqui esta buscando os nomes dos times do jogo			$dqlTime = "SELECT t FROM Time t WHERE t.codTime=$imprime1 ";			$queryTime = $entityManager->createQuery($dqlTime);			$times = $queryTime->getResult();			foreach ($times as $time){				$time1=$time->getNomeTime();			}			//Aqui esta buscando os nomes dos times do jogo			$dqlTime = "SELECT t FROM Time t WHERE t.codTime=$imprime2 ";			$queryTime = $entityManager->createQuery($dqlTime);			$times = $queryTime->getResult();			foreach ($times as $time){				$time2=$time->getNomeTime();			}			//Aqui esta testando se a busca voltou com alguma aposta ou nao			if ($apostas<>NULL){				foreach ($apostas as $aposta){					$apostaGolsTime1=$aposta->getApostaGolsTime1();					$apostaGolsTime2=$aposta->getApostaGolsTime2();				}				echo "<TD> $time1							<INPUT type='hidden' name='$numeroJogo' value='$codJogo'>	<SELECT name=$apostaGolsUsuarioTime1>	<OPTION VALUE=$apostaGolsTime1>$apostaGolsTime1</OPTION>";				for($indiceEscolhaUsuario = 0 ; $indiceEscolhaUsuario < 100 ; $indiceEscolhaUsuario++ ){					echo "<OPTION VALUE=$indiceEscolhaUsuario>$indiceEscolhaUsuario</OPTION>";				}				echo "</SELECT>	</TD>";				echo "<TD>$imprimeLetraX   </TD>";				echo "<TD >			<SELECT name=$apostaGolsUsuarioTime2>			<OPTION VALUE=$apostaGolsTime2>$apostaGolsTime2</OPTION>";				// Esse for e para imprimir as opcoes de palpite para o jogo				for($indiceEscolhaUsuario = 0 ; $indiceEscolhaUsuario < 100 ; $indiceEscolhaUsuario++ ){					echo "<OPTION VALUE=$indiceEscolhaUsuario>$indiceEscolhaUsuario</OPTION>";				}				echo "</SELECT>$time2	</TD>	<br>";			}			else {				// Esse for serve para imprimir todo os jogos corrente da rodada.				echo "<TD >$time1			<INPUT type='hidden' name='$numeroJogo' value='$codJogo'>		<SELECT name=$apostaGolsUsuarioTime1>		<OPTION VALUE=$opcaoVazia>$opcaoVazia</OPTION>";			// Esse for e para imprimir as opcoes de palpite para o jogo			for($indiceEscolhaUsuario = 0 ; $indiceEscolhaUsuario < 100 ; $indiceEscolhaUsuario++ ){				echo "<OPTION VALUE=$indiceEscolhaUsuario>$indiceEscolhaUsuario</OPTION>";			}			echo "</SELECT>		</TD>";			echo "<TD>$imprimeLetraX   </TD>";			echo "<TD >		<SELECT name=$apostaGolsUsuarioTime2>		<OPTION VALUE=$opcaoVazia>$opcaoVazia</OPTION>";							// Esse for e para imprimir as opcoes de palpite para o jogo			for($indiceEscolhaUsuario = 0 ; $indiceEscolhaUsuario < 100 ; $indiceEscolhaUsuario++ ){				echo "<OPTION VALUE=$indiceEscolhaUsuario>$indiceEscolhaUsuario</OPTION>";			}			echo "</SELECT>$time2	</TD>	<br>";			}			$contadorArray++;		}		//Aqui esta enviando os palpites do usuario pra outra pagina		echo "<table><br><INPUT type='submit' value='Salvar Apostas'> </h2> </table> </table></form></table></body></html>";	}/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////?>