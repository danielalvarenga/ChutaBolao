<?php $conn = $entityManager->getConnection();$conn->beginTransaction();try{	$dataAgora = new DateTime('now', new DateTimeZone('America/Sao_Paulo'));	$dataAtual = $dataAgora->format( "Y-m-d H:i:s" );		$dql = "SELECT c FROM Campeonato c WHERE c.status='ativo' ";	$query= $entityManager->createQuery($dql);	$campeonatos= $query->getResult();		if($campeonatos<>NULL){ 				foreach ($campeonatos as $campeonato){						//Essa parte do codigo busca os jogos cadastradas dentro do banco de dados.						$dql = "SELECT j FROM Jogo j WHERE'$dataAtual'>= j.dataInicioApostas AND '$dataAtual						'<=j.dataFimApostas AND j.campeonato=".$campeonato->getCodCampeonato()." ORDER BY j.dataJogo ";			$query = $entityManager->createQuery($dql);			$jogos = $query->getResult();						echo '					<table id="tabela" cellspacing=0>						<td id="aposta" align="center" colspan="7">'							.$campeonato->getNomeCampeonato().' '							.$campeonato->getAnoCampeonato().'					</td>';						//Aqui esta testando se a busca voltou com algum jogo ou nao						if($jogos<>NULL){							//Essa parte do codigo busca os jogos cadastradas dentro do banco de dados.						foreach ($jogos as $jogo){											// Essa parte do codigo busca aposta do usuario de acordo com o numero do					//jogo cadastradas dentro do banco de dados.											$time = $entityManager->find("Time", $jogo->getCodtime1());					$time1 = $time->getNomeTime();					$escudo1 = $time->getEscudo();										//Aqui esta buscando os nomes dos times do jogo					$time = $entityManager->find("Time", $jogo->getCodtime2());					$time2 = $time->getNomeTime();					$escudo2 = $time->getEscudo();												echo "											<tr class=\"linha\" align='center'>												<td class=\"coluna\" align=\"right\">"													.$time1."												</td>												<td class=\"coluna\" >														<img class=\"escudo\" src='$escudo1'>													 X												</td>	  												<td class=\"coluna\" align=\"left\">													<img class=\"escudo\" src='$escudo2'>												</td>												<td class=\"coluna\" align=\"left\">"														.$time2."																				</td>												<td class=\"coluna\" align=\"left\">													Posicao												</td>												<td class=\"coluna\" align=\"left\">													Quantidade de Apostas												</td>											</tr>";										$dql = "SELECT ca FROM ContadorAposta ca WHERE ca.campeonato=".$campeonato->getCodCampeonato().			" AND ca.jogo=".$jogo->getCodjogo()."ORDER BY ca.quantidadeApostas DESC";						$query = $entityManager->createQuery($dql);			$query->setMaxResults(3);			$contadorApostas = $query->getResult();					//Aqui esta testando se a busca voltou com algum jogo ou nao		if ($contadorApostas<>NULL){				$contador=1;			foreach ($contadorApostas as $contadorAposta){	//Aqui esta buscando os nomes dos times do jogo							echo"						<tr class=\"linha\" align='center'>												<td class=\"coluna\" >												</td>												<td class=\"coluna\" align=\"right\">  "														.$contadorAposta->getOpcaoCadastrada()."												</td>												<td class=\"coluna\" >												</td>												<td class=\"coluna\" >												</td>																								<td class=\"coluna\" align=\"left\">"														.$contador."º lugar												</td>																								<td class=\"coluna\" align=\"left\">"														.$contadorAposta->getQuantidadeApostas()."												</td>						</tr>						";			$contador++;														}					}												}						}				else{				echo				"<p align='center'>					<table id='tabela'>					<tr class=\"linha\">					<td class=\"coluna\">					<p align='center'>Não existem jogos abertos. Volte amanhã para conferir.</p>					</td>					</tr>					</table>";							}				echo "	</table>		<br>";			}	$conn->commit();		}} catch(Exception $e) {	$conn->rollback();	echo	"<p align='center'>	<table id='tabela'>	<tr class=\"linha\">	<td class=\"coluna\">	<p align='center'>Não existem jogos abertos. Volte amanhã para conferir.</p>	</td>	</tr>	</table>";}$conn->close();?>
